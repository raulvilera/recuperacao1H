<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Atividade de Biologia - Recuperação 1ª Série H</title>
    <style>
        /* Reset e configurações gerais */
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #d0d0d0;
            padding: 20px;
            min-height: 100vh;
            background-image: linear-gradient(145deg, #c0c0c0, #e0e0e0);
        }
        
        /* Container principal */
        .container {
            max-width: 900px;
            margin: 0 auto;
            position: relative;
        }
        
        .container::before {
            content: '';
            position: absolute;
            top: -10px;
            left: -10px;
            right: -10px;
            bottom: -10px;
            background-color: #d0d0d0;
            z-index: 1;
            border-radius: 20px;
            box-shadow: inset 5px 5px 10px #b3b3b3, 
                       inset -5px -5px 10px #ededed;
        }
        
        /* Cabeçalho */
        .header {
            text-align: center;
            margin-bottom: 30px;
            padding: 25px 20px;
            background: linear-gradient(145deg, #004d00, #000000);
            border-radius: 15px;
            box-shadow: 8px 8px 16px #b3b3b3, 
                       -8px -8px 16px #ffffff;
            position: relative;
            z-index: 2;
            border: 1px solid #003300;
            color: white;
        }
        
        .school-name {
            font-size: 20px;
            font-weight: bold;
            margin-bottom: 15px;
            color: white;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
        }
        
        /* Informações do aluno - Layout responsivo */
        .student-info {
            display: grid;
            grid-template-columns: 2fr 1fr 1fr 1fr;
            gap: 12px;
            margin-bottom: 15px;
            align-items: center;
        }
        
        @media (max-width: 768px) {
            .student-info {
                grid-template-columns: 1fr;
                gap: 15px;
            }
        }
        
        .info-group {
            display: flex;
            align-items: center;
        }
        
        .name-group {
            grid-column: 1 / 2;
        }
        
        @media (max-width: 768px) {
            .name-group {
                grid-column: 1 / 2;
            }
        }
        
        .info-label {
            margin-right: 8px;
            font-weight: bold;
            color: white;
            white-space: nowrap;
            font-size: 14px;
        }
        
        .info-field {
            padding: 10px;
            border: 1px solid #a0c4e0;
            border-radius: 6px;
            background-color: #f8fbff;
            box-shadow: inset 2px 2px 4px rgba(0,0,0,0.1);
            text-align: center;
            width: 100%;
            color: black;
            font-size: 14px;
        }
        
        .activity-title {
            font-size: 22px;
            font-weight: bold;
            margin: 20px 0;
            text-align: center;
            color: white;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
        }
        
        /* Questões */
        .question-container {
            padding: 25px;
            margin-bottom: 30px;
            background: #d0d0d0; /* Alterado para cinza */
            border-radius: 15px;
            box-shadow: 8px 8px 16px #b3b3b3, 
                       -8px -8px 16px #ffffff;
            position: relative;
            z-index: 2;
            border: 1px solid #cccccc; /* Alterado para cinza mais claro */
            color: black; /* Alterado para preto */
        }
        
        .question {
            margin-bottom: 20px;
            font-weight: bold;
            color: black; /* Alterado para preto */
            line-height: 1.5;
            font-size: 16px;
            background-color: #add8e6; /* Azul claro */
            padding: 15px;
            border-radius: 10px;
            border: 1px solid #a0c4e0;
        }
        
        .question-image {
            max-width: 100%;
            height: auto;
            margin: 15px 0;
            border-radius: 10px;
            box-shadow: 4px 4px 8px rgba(0,0,0,0.2);
            border: 1px solid #a0c4e0;
            display: block;
        }
        
        .options {
            margin-top: 20px;
        }
        
        .option {
            margin-bottom: 12px;
            padding: 15px;
            background: linear-gradient(145deg, #ffffff, #f0f0f0);
            border-radius: 10px;
            border: 1px solid #d0d0d0;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 4px 4px 8px rgba(0,0,0,0.1),
                       -4px -4px 8px rgba(255,255,255,0.7);
            display: flex;
            align-items: flex-start;
            color: black;
            font-size: 15px;
        }
        
        .option:hover {
            background: linear-gradient(145deg, #f5f5f5, #e8e8e8);
            transform: translateY(-2px);
            box-shadow: 6px 6px 12px rgba(0,0,0,0.15),
                       -6px -6px 12px rgba(255,255,255,0.8);
        }
        
        .option.selected {
            background: linear-gradient(145deg, #155724, #0f4019);
            border-color: #0f4019;
            color: white;
            box-shadow: inset 2px 2px 4px rgba(0,0,0,0.3),
                        4px 4px 8px rgba(0,0,0,0.1);
        }
        
        /* Letras das alternativas - apenas via pseudo-elemento */
        .option::before {
            content: attr(data-letter) ".";
            font-weight: bold;
            margin-right: 10px;
            flex-shrink: 0;
            font-size: 16px;
        }
        
        /* Botões */
        .buttons {
            display: flex;
            justify-content: space-between;
            margin-top: 25px;
            position: relative;
            z-index: 2;
            gap: 20px;
        }
        
        @media (max-width: 480px) {
            .buttons {
                flex-direction: column;
            }
        }
        
        button {
            padding: 14px 30px;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            transition: all 0.3s ease;
            box-shadow: 6px 6px 12px rgba(0,0,0,0.2),
                       -6px -6px 12px rgba(255,255,255,0.7);
            flex: 1;
        }
        
        #submitBtn {
            background: linear-gradient(145deg, #007bff, #0056b3);
            color: white;
        }
        
        #submitBtn:hover {
            background: linear-gradient(145deg, #0056b3, #004085);
            transform: translateY(-2px);
            box-shadow: 8px 8px 16px rgba(0,0,0,0.25),
                       -8px -8px 16px rgba(255,255,255,0.7);
        }
        
        #submitBtn:active {
            transform: translateY(1px);
            box-shadow: inset 2px 2px 4px rgba(0,0,0,0.2);
        }
        
        #clearBtn {
            background: linear-gradient(145deg, #6c757d, #545b62);
            color: white;
        }
        
        #clearBtn:hover {
            background: linear-gradient(145deg, #545b62, #3d4348);
            transform: translateY(-2px);
            box-shadow: 8px 8px 16px rgba(0,0,0,0.25),
                       -8px -8px 16px rgba(255,255,255,0.7);
        }
        
        #clearBtn:active {
            transform: translateY(1px);
            box-shadow: inset 2px 2px 4px rgba(0,0,0,0.2);
        }
        
        /* Resultado */
        .result {
            margin-top: 25px;
            padding: 20px;
            border-radius: 10px;
            display: none;
            box-shadow: 4px 4px 8px rgba(0,0,0,0.1);
            position: relative;
            z-index: 2;
            font-size: 16px;
        }
        
        .success {
            background: linear-gradient(145deg, #d4edda, #c3e6cb);
            border: 1px solid #c3e6cb;
            color: #155724;
        }
        
        .error {
            background: linear-gradient(145deg, #f8d7da, #f5c6cb);
            border: 1px solid #f5c6cb;
            color: #721c24;
        }
        
        /* Instruções */
        .instructions {
            background: linear-gradient(145deg, #e6f2ff, #cce5ff);
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 25px;
            box-shadow: 4px 4px 8px rgba(0,0,0,0.1);
            position: relative;
            z-index: 2;
            border: 1px solid #b8d4f0;
            color: #004085;
            font-size: 15px;
            line-height: 1.5;
        }
        
        .instructions h3 {
            margin-bottom: 10px;
            color: #004085;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="school-name">E.E. PROFª LYDIA KITZ MOREIRA</div>
            <div class="student-info">
                <div class="info-group name-group">
                    <span class="info-label">NOME:</span>
                    <select id="studentName" class="info-field">
                        <option value="">Selecione seu nome</option>
                        <!-- Opções serão preenchidas via JavaScript -->
                    </select>
                </div>
                <div class="info-group">
                    <span class="info-label">Nº:</span>
                    <input type="text" id="studentNumber" class="info-field" readonly>
                </div>
                <div class="info-group">
                    <span class="info-label">SÉRIE:</span>
                    <input type="text" id="studentGrade" class="info-field" value="1ª Série H" readonly>
                </div>
                <div class="info-group">
                    <span class="info-label">DATA:</span>
                    <input type="text" id="currentDate" class="info-field" value="" readonly>
                </div>
            </div>
            <div class="activity-title">ATIVIDADE DE BIOLOGIA (RECUPERAÇÃO 1ª SÉRIE H)</div>
        </div>
        
        <div class="instructions">
            <h3>INSTRUÇÕES:</h3>
            <p>1. Selecione seu nome na lista acima para preencher automaticamente seus dados.</p>
            <p>2. Leia atentamente cada questão e selecione a alternativa que considera correta.</p>
            <p>3. Após responder todas as questões, clique em "Enviar Respostas".</p>
            <p>4. Você poderá visualizar sua pontuação após o envio.</p>
        </div>
        
        <div id="questionsContainer">
            <!-- As questões serão inseridas aqui via JavaScript -->
        </div>
        
        <div class="buttons">
            <button id="submitBtn">Enviar Respostas</button>
            <button id="clearBtn">Limpar Respostas</button>
        </div>
        
        <div id="resultMessage" class="result"></div>
    </div>

   
<script>
/* ============================================================
   CONSTANTES / CONFIG
   ============================================================ */
const GOOGLE_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbzhnHCa5l5o258-izyGKEiw9YRCDStTTX_npnMODR78dccza9mLDuwNiUHshZIOTOea/exec";

/* ============================================================
   LISTA DE ALUNOS
   ============================================================ */
const students = {
  "1ª Série H": [
    { number: "1", name: "ALEXANDRE BATISTA DOS SANTOS" },
    { number: "5", name: "ANA LÍVIA BRAGA DOS SANTOS" },
    { number: "11", name: "DANIELLE OLIVEIRA DA SILVA NUNES" },
    { number: "14", name: "ELOYSA ANDRADE OLIVEIRA SILVA" },
    { number: "18", name: "FELIPE MARCONDES SILVA" },
    { number: "19", name: "GEOVANA FERREIRA DA SILVA SOUZA" },
    { number: "20", name: "GEOVANNA GABRIELA PIERRE SILVA" },
    { number: "24", name: "ISAAK ALVAREZ MARQUEZ CAETANO" },
    { number: "33", name: "KEMILLY VITORIA RODRIGUES MARIANO" },
    { number: "34", name: "LAURA LUIZA DOS SANTOS ALMEIDA" },
    { number: "37", name: "MARIA EDUARDA VENCESLAU DE SOUZA" },
    { number: "38", name: "MATHEUS CAVALCANTE LISBOA" },
    { number: "40", name: "MURILLO SOUZA RODRIGUES DOS SANTOS" },
    { number: "45", name: "PEDRO HENRIQUE MAURICIO DA SILVA CHAGAS" },
    { number: "48", name: "RHUAN LIMA OLIVEIRA" },
    { number: "49", name: "THAINA FIDELIS XAVIER DA SILVA" },
    { number: "54", name: "DENIS CASTRO DURVALDO" },
    { number: "56", name: "ISAAC LEMOS SANTOS" },
    { number: "57", name: "EMILLY EDUARDA BONIFACIO DE AMORIM CORREA" },
    { number: "59", name: "LEONARDO ABADE DA SILVA DANTAS" },
    { number: "62", name: "PYETRA GOMES MARTINS" },
    { number: "64", name: "CARLOS EDUARDO MARTINS DA SILVA" },
    { number: "66", name: "STELLA MARTINS DA SILVA" },
    { number: "67", name: "DYESSICA MAYARA DOS SANTOS GOMES" },
    { number: "68", name: "LARISSA DE LOURDES DOS SANTOS" },
    { number: "70", name: "GUSTAVO RODRIGUES DE SOUZA" },
    { number: "72", name: "NAYARA BARROS DE MORAIS" },
    { number: "73", name: "VITÓRIA SANTOS TEIXEIRA" },
    { number: "75", name: "JOÃO PAULO RODRIGUES DE SOUZA FILHO" },
    { number: "76", name: "MARIA EDUARDA DE OLIVEIRA RODRIGUES" },
    { number: "77", name: "LUIZ HENRIQUE JESUS DOS SANTOS FABRICIO" },
    { number: "78", name: "EDUARDO CARRASCOSA PINTOR" },
    { number: "79", name: "GUILHERME DANIEL VELOSO DOS SANTOS" },
    { number: "80", name: "JOAO GABRIEL AMORIM TOBIAS" },
    { number: "81", name: "RIAN SANTOS MACHADO" },
    { number: "82", name: "JULIA ARAUJO DE LIMA" },
    { number: "83", name: "BRENDA ROSA DA SILVA" },
    { number: "84", name: "CAMILA APPOLINÁRIO" },
    { number: "85", name: "ARTHUR CASTRO SILVA" },
    { number: "86", name: "KAMILA NEVES BRITO" }
  ]
};

/* ============================================================
   QUESTÕES (texto, imagem opcional, alternativas com flag 'correct')
   ============================================================ */
const questions = [
  {
    id: 1,
    question: "Em 2023, paleontólogos brasileiros anunciaram a descoberta de fósseis de estromatólitos com 2,4 bilhões de anos na região da Serra do Espinhaço... Por que as cianobactérias foram capazes de transformar radicalmente a atmosfera terrestre primitiva?",
    image:"https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjez1FXJB-OBbaaOnlERIXjAKVVePF0innTJ_vRkOPWNy1hh00YFDm8rrjI0AqR4nbXxCmLd3tp7bsdcjETSp7Rn1PGUkB_ldd71S7zq7nY9sLBTnodDZHzZA89lcEBUqjYfeJN45YnszrzzJZfY8_Dje6P6vqm-8s4GhKEllRguUg3yeR8LzSvT4rOStHm/s450/Capturar.JPG",
    options: [
      { text: "Por serem organismos autótrofos fotossintetizantes, liberavam oxigênio como subproduto metabólico, permitindo a oxigenação progressiva da atmosfera e possibilitando o surgimento de organismos aeróbicos.", correct: true },
      { text: "Por possuírem capacidade de fixação de nitrogênio atmosférico, enriqueceram os solos primitivos com compostos nitrogenados essenciais para o desenvolvimento de outras formas de vida.", correct: false },
      { text: "Por apresentarem reprodução sexuada, garantiam variabilidade genética que permitia rápida adaptação às condições ambientais em constante mudança no planeta primitivo.", correct: false },
      { text: "Por formarem associações simbióticas com fungos primitivos, criavam os primeiros ecossistemas complexos que sustentavam cadeias alimentares incipientes.", correct: false }
    ]
  },
  {
    id: 2,
    question: "Experimento com fatias de batata em soluções com diferentes concentrações de sal — quais as implicações fisiológicas para plantas em solos salinizados?",
    image:"https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhliX-oWUrgpMsuUHI7_rGJzL81yY8DVq-tiaHtj3V-rPtwGyydXZP2iPlfji6R2JXD7k6DQM_v-tSSoBpTyCqu5UH54z73DKt4i31xT9eIYJLChM_iCj47vmVblrHsJmvFnCFaoJdow4XgbiNn9pEG9wEti97DAKAcPmTcyPouNbrbQJEnatjpWAtlKEKJ/s450/Capturar.JPG",
    options: [
      { text: "Em solos salinizados (hipertônicos), as plantas perdem água por osmose, podendo sofrer desidratação severa e plasmólise, o que explica a dificuldade de cultivo agrícola em áreas com alta concentração de sais.", correct: true },
      { text: "A turgescência celular em ambientes hipotônicos é prejudicial às plantas porque causa ruptura da parede celular devido ao excessivo influxo de sais minerais através de transporte ativo.", correct: false },
      { text: "As alterações de volume observadas resultam principalmente da difusão facilitada de íons através de proteínas carreadoras, que respondem às variações no potencial elétrico da membrana.", correct: false },
      { text: "O fenômeno demonstra a capacidade das células vegetais de realizar fagocitose seletiva, absorvendo ou expelindo água conforme a concentração do meio externo para manter seu volume constante.", correct: false }
    ]
  },
  {
    id: 3,
    question: "Linhagem bacteriana com potencial para transformar resíduos agroindustriais em bioplásticos — como as características morfológicas e metabólicas favorecem esse uso?",
    image:"https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEiKfgtpuEIx2hbm5A2aSJfff2VI_pcIcXNJhGcVN5T3tCbg6jj9fYKkg2ea1gdbg4DMivuZPcsY19TY0yrzQ3SgWFmK2tYggW6NtG3NehYXaWLMvKX_YmIbxAVxZQDgEBq_FyfdpQeS1Gc8GVb4jiZyVZc6Yl718zPy0RZL4dkpr9fbNMR5_2b6JwQcLxP8/s450/Capturar.JPG",
    options: [
      { text: "A forma bacilar aumenta a relação superfície/volume, facilitando a absorção de nutrientes; o metabolismo fermentativo permite transformar resíduos orgânicos em polímeros sem necessidade de oxigênio, viabilizando processos industriais em condições controladas.", correct: true },
      { text: "A capacidade de esporulação, comum em bactérias com essa morfologia, garante resistência a condições adversas, mas reduz a eficiência dos processos fermentativos por consumir energia destinada à produção de biopolímeros.", correct: false },
      { text: "Bactérias com metabolismo exclusivamente aeróbio seriam mais adequadas, pois a respiração celular gera maior quantidade de ATP, acelerando a síntese de bioplásticos em reatores aerados continuamente.", correct: false },
      { text: "A forma cocoide seria mais vantajosa por permitir maior compactação em biorreatores, aumentando a densidade celular e consequentemente a produtividade do processo biotecnológico.", correct: false }
    ]
  },
  {
    id: 4,
    question: "Aspergillus tubingensis degrada poliuretano rapidamente — qual o potencial ecológico e tecnológico dessa descoberta?",
    options: [
      { text: "Os fungos realizam digestão extracelular através de enzimas hidrolíticas que degradam macromoléculas complexas no ambiente, podendo ser aplicados em estratégias de biorremediação para decompor plásticos em componentes menos nocivos.", correct: true },
      { text: "A capacidade fotossintética dos fungos permite fixar CO₂ atmosférico enquanto degradam plásticos, gerando um balanço positivo de oxigênio que compensa os impactos ambientais da poluição por polímeros sintéticos.", correct: false },
      { text: "Por serem organismos autótrofos quimiossintetizantes, os fungos transformam plásticos em biomassa sem consumir outros recursos orgânicos, criando um ciclo sustentável de aproveitamento de resíduos.", correct: false },
      { text: "A reprodução sexuada dos fungos por esporulação garante variabilidade genética que acelera a evolução de linhagens ainda mais eficientes na degradação de diferentes tipos de polímeros em condições naturais.", correct: false }
    ]
  },
  {
    id: 5,
    question: "Leveduras GM fermentando glicose e xilose para produzir etanol de 2ª geração — quais as vantagens biotecnológicas?",
    options: [
      { text: "A capacidade de fermentar tanto pentoses quanto hexoses maximiza o aproveitamento da biomassa vegetal, aumentando o rendimento do processo e reduzindo custos, além de valorizar resíduos agrícolas que seriam descartados.", correct: true },
      { text: "A fermentação alcoólica é menos eficiente energeticamente que a respiração aeróbia, mas produz etanol com maior pureza, eliminando a necessidade de etapas posteriores de destilação e desidratação do biocombustível.", correct: false },
      { text: "O processo fermentativo consome mais ATP do que gera, exigindo suplementação energética contínua que inviabiliza economicamente a produção em larga escala de biocombustíveis a partir de resíduos lignocelulósicos.", correct: false },
      { text: "Leveduras selvagens já possuem naturalmente a capacidade de metabolizar todos os açúcares presentes na biomassa, tornando desnecessário o desenvolvimento de linhagens geneticamente modificadas para esse fim específico.", correct: false }
    ]
  },
  {
    id: 6,
    question: "A descoberta da penicilina por Fleming — qual a interpretação ecológica e aplicada dessa descoberta?",
    options: [
      { text: "Fungos produzem antibióticos como metabólitos secundários para inibir o crescimento de bactérias competidoras no ambiente, uma estratégia ecológica que foi aproveitada para desenvolver medicamentos que salvam milhões de vidas.", correct: true },
      { text: "A produção de penicilina é um mecanismo de defesa contra predadores animais que se alimentam de fungos, tendo sua ação antibacteriana descoberta fortuitamente durante investigações sobre toxicidade para mamíferos.", correct: false },
      { text: "Antibióticos como a penicilina são produtos primários do metabolismo energético dos fungos, essenciais para seu crescimento, mas que apresentam efeito colateral de inibição do desenvolvimento de populações bacterianas.", correct: false },
      { text: "A capacidade de produzir substâncias antibacteriana é exclusiva de fungos parasitas que infectam tecidos animais, evoluindo como mecanismo para suprimir o sistema imune dos hospedeiros durante o processo infeccioso.", correct: false }
    ]
  },
  {
    id: 7,
    question: "Micorrizas: qual o significado evolutivo da associação entre plantas e fungos?",
    options: [
      { text: "As micorrizas aumentam drasticamente a superfície de absorção radicular, facilitando a aquisição de água e nutrientes pouco móveis como fósforo, o que foi crucial para a colonização do ambiente terrestre pelas plantas há mais de 400 milhões de anos.", correct: true },
      { text: "A associação micorrízica permite que as plantas realizem fotossíntese com maior eficiência devido aos pigmentos acessórios dos fungos que absorvem comprimentos de onda luminosa não utilizados pelos cloroplastos.", correct: false },
      { text: "Fungos micorrízicos fixam nitrogênio atmosférico, tornando-o disponível para as plantas em forma de amônio, reduzindo a dependência de bactérias fixadoras como Rhizobium em ecossistemas naturais e agrícolas.", correct: false },
      { text: "As plantas fornecem aminoácidos essenciais aos fungos simbiontes, que por sua vez sintetizam vitaminas do complexo B, estabelecendo uma complementaridade nutricional que aumenta a resistência a estresses bióticos e abióticos.", correct: false }
    ]
  },
  {
    id: 8,
    question: "Bomba Na+/K+ ATPase — implicações fisiológicas para neurônios e transmissão nervosa?",
    options: [
      { text: "A bomba estabelece um gradiente de concentração com alta [K+] intracelular e alta [Na+] extracelular, criando um potencial de membrana negativo em repouso essencial para a excitabilidade neuronal e a transmissão sináptica.", correct: true },
      { text: "O transporte ativo de Na+ para dentro e K+ para fora da célula gera um potencial de membrana positivo que facilita a liberação de neurotransmissores nas terminações axonais durante a propagação do impulso nervoso.", correct: false },
      { text: "A Na+/K+ ATPase funciona como um canal iônio regulado por voltagem, alternando entre estados abertos e fechados conforme o potencial de membrana, sem consumir ATP diretamente em seu mecanismo de ação.", correct: false },
      { text: "Este mecanismo mantém equilíbrio osmótico através do transporte conjunto de água junto com os íons, prevenindo alterações de volume celular que poderiam comprometer a integridade estrutural dos neurônios.", correct: false }
    ]
  },
  {
    id: 9,
    question: "Líquens como bioindicadores — por que são sensíveis a poluentes atmosféricos?",
    options: [
      { text: "O fungo fornece proteção e retenção de umidade, enquanto o fotobionte realiza fotossíntese produzindo carboidratos; a ausência de estruturas de proteção torna os líquens sensíveis a poluentes que danificam suas células e rompem a simbiose.", correct: true },
      { text: "Líquens são pioneiros na sucessão ecológica porque o fungo fixa nitrogênio atmosférico enquanto a alga produz antibióticos que eliminam competidores, estratégia comprometida por poluentes que inibem a atividade antimicrobiana.", correct: false },
      { text: "A simbiose permite que líquens sobrevivem em ambientes extremos porque o fungo realiza quimiossíntese oxidando compostos inorgânicos, enquanto a alga fornece vitaminas essenciais; poluentes interferem nesses processos metabólicos complementares.", correct: false },
      { text: "Líquens são tolerantes à poluição porque acumulam metais pesados em vacúolos especializados, funcionando como fitoestabilizadores naturais; seu desaparecence indica saturação da capacidade de armazenamento desses poluentes.", correct: false }
    ]
  },
  {
    id: 10,
    question: "Proteínas à base de micélio — qual o potencial dessa tecnologia para sustentabilidade alimentar?",
    options: [
      { text: "O micélio vegetativo cresce rapidamente em substratos de baixo custo como resíduos agroindustriais, pode ser processado para obter texturas variadas e possui menor impacto ambiental que a pecuária tradicional, representando alternativa sustentável para segurança alimentar.", correct: true },
      { text: "Fungos produzem naturalmente colesterol e gorduras saturadas em quantidades similares às carnes vermelhas, mantendo características sensoriais familiares aos consumidores mas sem os benefícios nutricionais de proteínas vegetais convencionais.", correct: false },
      { text: "O cultivo de micélio para alimentação requer condições estéreis e substratos nobres como grãos selecionados, tornando o processo energeticamente mais dispendioso que a produção de proteínas animais em sistemas intensivos convencionais.", correct: false },
      { text: "Proteínas fúngicas carecem de aminoácidos essenciais como lisina e metionina, necessitando fortificação com suplementos sintéticos que reduzem a sustentabilidade do produto final em comparação com fontes proteicas tradicionais.", correct: false }
    ]
  }
];

/* ============================================================
   UTILITÁRIOS
   ============================================================ */
function showResult(msg, type="success"){
  const box = document.getElementById("statusBox");
  box.style.display = "block";
  box.className = "result " + (type === "error" ? "error" : "success");
  box.innerHTML = msg;
}
function hideResult(){
  const box = document.getElementById("statusBox");
  box.style.display = "none";
  box.innerHTML = "";
}
function safeNumber(v){
  if (v === undefined || v === null || v === "") return "";
  const n = Number(String(v).replace(",","."));
  return Number.isFinite(n) ? n : "";
}

/* ============================================================
   RENDERIZAÇÃO
   ============================================================ */
document.addEventListener("DOMContentLoaded", () => {
  const select = document.getElementById("studentName");
  const num = document.getElementById("studentNumber");
  const grade = document.getElementById("studentGrade");
  const container = document.getElementById("questionsContainer");
  const dateField = document.getElementById("currentDate");

  // Data atual
  const today = new Date();
  dateField.value = today.toLocaleDateString('pt-BR');

  // Monta select com optgroup por turma
  Object.keys(students).forEach(turma => {
    const group = document.createElement("optgroup");
    group.label = turma;

    students[turma].forEach(s => {
      const opt = document.createElement("option");
      opt.value = `${s.number}|${turma}|${s.name}`;
      opt.textContent = `${s.number} — ${s.name}`;
      group.appendChild(opt);
    });

    select.appendChild(group);
  });

  // Monta questões
  questions.forEach(q => {
    const block = document.createElement("div");
    block.className = "question-container";
    block.id = "q" + q.id;

    const qHtml = document.createElement("div");
    qHtml.innerHTML = `<p class="question"><strong>Questão ${q.id}:</strong> ${q.question}</p>`;
    block.appendChild(qHtml);

    if (q.image){
      const img = document.createElement("img");
      img.src = q.image;
      img.className = "question-image";
      img.alt = `Imagem da questão ${q.id}`;
      block.appendChild(img);
    }

    const optBox = document.createElement("div");
    optBox.className = "options";
    q.options.forEach((opt, idx) => {
      const letter = String.fromCharCode(65 + idx);
      const optionDiv = document.createElement("div");
      optionDiv.className = "option";
      optionDiv.tabIndex = 0;
      optionDiv.dataset.question = q.id;
      optionDiv.dataset.letter = letter;
      optionDiv.textContent = `${letter}) ${opt.text}`;

      optionDiv.addEventListener("click", () => {
        // toggle selection exclusive
        optBox.querySelectorAll(".option").forEach(o => o.classList.remove("selected"));
        optionDiv.classList.add("selected");
        hideResult();
      });

      optionDiv.addEventListener("keypress", (ev) => {
        if (ev.key === "Enter" || ev.key === " ") {
          ev.preventDefault();
          optionDiv.click();
        }
      });

      optBox.appendChild(optionDiv);
    });

    block.appendChild(optBox);
    container.appendChild(block);
  });

  select.addEventListener("change", () => {
    if (!select.value) {
      num.value = "";
      grade.value = "";
      return;
    }
    const [studentNumber, studentGrade, studentName] = select.value.split("|");
    num.value = studentNumber;
    grade.value = studentGrade;
    hideResult();
  });

  document.getElementById("clearBtn").addEventListener("click", () => {
    document.querySelectorAll(".option.selected").forEach(o => o.classList.remove("selected"));
    document.getElementById("submitBtn").disabled = false;
    hideResult();
  });
});

/* ============================================================
   ENVIO: função robusta com timeout e parsing
   ============================================================ */
async function sendToGoogle(dataObj, timeoutMs = 15000) {
  // AbortController para timeout
  const controller = new AbortController();
  const timeout = setTimeout(() => controller.abort(), timeoutMs);

  try {
    const response = await fetch(GOOGLE_SCRIPT_URL, {
      method: "POST",
      headers: {
        "Content-Type": "application/json"
      },
      body: JSON.stringify(dataObj),
      signal: controller.signal,
      credentials: "omit" // não envia cookies
    });

    clearTimeout(timeout);

    // tenta ler como JSON, mas prepara mensagem amigável caso não seja JSON
    const text = await response.text();
    let json = null;
    try {
      json = text ? JSON.parse(text) : null;
    } catch (parseErr) {
      // não-JSON recebido
      if (!response.ok) {
        throw new Error(`Resposta inválida do servidor (HTTP ${response.status}).`);
      } else {
        // resposta 200 mas não JSON -> trata como sucesso parcial
        return { status: "ok", raw: text };
      }
    }

    return json;
  } catch (err) {
    // Diferencia abort (timeout) de outros erros
    if (err.name === "AbortError") {
      throw new Error("Tempo de conexão esgotou (timeout). Verifique a internet ou o backend.");
    } else {
      throw err;
    }
  } finally {
    clearTimeout(timeout);
  }
}

/* ============================================================
   LOGICA DE SUBMIT (valida, pontua, envia)
   ============================================================ */
document.getElementById("submitBtn").addEventListener("click", async () => {
  hideResult();
  const select = document.getElementById("studentName");
  if (!select.value) {
    showResult("Selecione seu nome na lista antes de enviar.", "error");
    return;
  }

  const [studentNumber, studentGrade, studentName] = select.value.split("|");

  const data = {
    studentName: studentName,
    studentNumber: studentNumber,
    studentGrade: studentGrade
  };

  let correct = 0;
  let allAnswered = true;
  const totalQuestions = questions.length;

  for (const q of questions) {
    const selected = document.querySelector(`#q${q.id} .option.selected`);
    if (!selected) { allAnswered = false; break; }
    const letter = selected.dataset.letter;
    data[`q${q.id}`] = letter;

    // verifica se correto
    const correctIndex = q.options.findIndex(opt => opt.correct);
    const correctLetter = String.fromCharCode(65 + correctIndex);
    if (letter === correctLetter) correct++;
  }

  if (!allAnswered) {
    showResult("Responda todas as questões antes de enviar.", "error");
    return;
  }

  // score e porcentagem
  data.finalScore = correct;
  data.percentage = Number(((correct / totalQuestions) * 100).toFixed(2));
  data.timestamp = new Date().toISOString();

  // bloqueia botão para evitar múltiplos envios
  const btn = document.getElementById("submitBtn");
  btn.disabled = true;
  showResult(`Processando... você acertou ${correct}/${totalQuestions}. Enviando dados...`, "success");

  try {
    const res = await sendToGoogle(data, 15000); // 15s timeout

    // Trata os formatos de resposta mais comuns
    if (!res) {
      showResult("Resposta vazia do servidor. Verifique a implantação do Apps Script.", "error");
      btn.disabled = false;
      return;
    }

    // Se o servidor retornou objeto com status
    if (typeof res === "object") {
      if (res.status === "success" || res.status === "ok") {
        showResult(`<strong>Sucesso!</strong> Dados registrados. Nota: ${data.finalScore}/${totalQuestions} (${data.percentage}%).`, "success");
        // mantém botão desabilitado após sucesso
      } else {
        // servidor devolveu erro controlado
        showResult(`<strong>Erro no servidor:</strong> ${res.message || JSON.stringify(res)}`, "error");
        btn.disabled = false;
      }
    } else {
      // res pode ser {status:"ok"} ou texto bruto
      if (typeof res === "string") {
        showResult("Resposta do servidor: " + res, "success");
      } else {
        showResult("Resposta inesperada do servidor. Verifique logs no Apps Script.", "error");
        btn.disabled = false;
      }
    }
  } catch (err) {
    // Possíveis motivos: timeout, CORS, network offline, URL inválida
    showResult(`<strong>Erro de Conexão:</strong> ${err.message}. Verifique a URL do Web App, permissões (Qualquer pessoa, mesmo anônima) e sua conexão.`, "error");
    btn.disabled = false;
    console.error("Erro ao enviar:", err);
  }
});
</script></body>
</html>
















